# 数字化研发平台 - 技术架构设计方案

> 设计时间: 2026-01-12
> 设计范围: 双核心 + 一底座总体架构

---

## 一、架构方案对比

### 方案一：微前端 + 微服务架构（推荐⭐）

#### 架构图
```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
│  PC浏览器  │  移动端  │  第三方系统                           │
└─────────────────────────────────────────────────────────────┘
                              ▲
                              │ HTTPS/WSS
┌─────────────────────────────────────────────────────────────┐
│                     微前端层 (qiankun)                       │
├─────────────────────────────────────────────────────────────┤
│  主应用    │  业务管理子应用  │  设计平台子应用  │  公共子应用 │
│  (React)   │    (React)      │     (React)     │   (React)   │
└─────────────────────────────────────────────────────────────┘
                              ▲
                              │ HTTP/REST
┌─────────────────────────────────────────────────────────────┐
│                    API网关层 (Kong/Nginx)                    │
│  认证鉴权  │  路由转发  │  限流熔断  │  监控日志              │
└─────────────────────────────────────────────────────────────┘
                              ▲
┌─────────────────────────────────────────────────────────────┐
│                   微服务层 (Spring Cloud/Go)                 │
├──────┬──────┬──────┬──────┬──────┬──────┬──────────────────┤
│用户  │业务  │设计  │数据  │AI    │文件  │工作流            │
│服务  │服务  │服务  │服务  │服务  │服务  │引擎              │
└──────┴──────┴──────┴──────┴──────┴──────┴──────────────────┘
                              ▲
┌─────────────────────────────────────────────────────────────┐
│                      中间件层                                │
│  Redis集群  │  Kafka集群  │  Elasticsearch  │  Neo4j        │
└─────────────────────────────────────────────────────────────┘
                              ▲
┌─────────────────────────────────────────────────────────────┐
│                    数据层                                   │
│  PostgreSQL  │  MongoDB  │  MinIO  │  数据湖              │
└─────────────────────────────────────────────────────────────┘
```

#### 技术栈清单

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **前端框架** | React 18 + TypeScript | 组件化开发，类型安全 |
| **微前端** | qiankun 2.x | 阿里开源，成熟稳定 |
| **UI组件库** | Ant Design 5.x | 企业级UI规范 |
| **状态管理** | Zustand | 轻量级状态管理 |
| **构建工具** | Vite 4.x | 快速开发体验 |
| **后端框架** | Spring Cloud Alibaba | Java微服务生态 |
| **API网关** | Spring Cloud Gateway | 统一入口 |
| **服务注册** | Nacos 2.x | 服务发现与配置中心 |
| **服务调用** | OpenFeign + Loadbalancer | 声明式HTTP客户端 |
| **分布式事务** | Seata 1.x | AT/TCC模式 |
| **消息队列** | Kafka 3.x | 高吞吐量消息处理 |
| **缓存** | Redis Cluster | 分布式缓存 |
| **搜索** | Elasticsearch 8.x | 全文检索与分析 |
| **图数据库** | Neo4j 4.x | 知识图谱与关联分析 |
| **关系数据库** | PostgreSQL 14+ | 主数据存储 |
| **文档数据库** | MongoDB 5.x | 非结构化数据 |
| **对象存储** | MinIO | 文件与图片存储 |
| **AI能力** | 通义千问/文心一言 | 大模型+RAG |

#### 优势
✅ **独立开发部署**：21个模块可独立开发、测试、部署
✅ **技术栈灵活**：不同模块可选择不同技术栈
✅ **故障隔离**：单个模块故障不影响整体
✅ **水平扩展**：按需扩展各服务实例
✅ **团队协作**：支持多团队并行开发

#### 劣势
⚠️ **复杂度高**：需要运维微服务和微前端两套体系
⚠️ **学习成本**：团队需要学习分布式系统知识
⚠️ **调试困难**：跨应用调试相对复杂

---

### 方案二：单体应用 + 模块化架构

#### 架构图
```
┌─────────────────────────────────────────────────────────────┐
│                        前端层                                │
│              单一React应用 (模块化组织)                      │
│  /src/modules/{market-insight, formula-design, ...}        │
└─────────────────────────────────────────────────────────────┘
                              ▲
                              │ HTTP/REST
┌─────────────────────────────────────────────────────────────┐
│                    单体后端应用                              │
│              Spring Boot (多模块Maven项目)                  │
│  /modules/{user-service, business-service, design-service} │
└─────────────────────────────────────────────────────────────┘
                              ▲
┌─────────────────────────────────────────────────────────────┐
│                      数据层                                  │
│  PostgreSQL  │  Redis  │  MinIO                             │
└─────────────────────────────────────────────────────────────┘
```

#### 技术栈清单

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **前端** | React 18 + TypeScript | 单一应用 |
| **路由** | React Router 6 | 模块化路由 |
| **后端** | Spring Boot 3.x | 单体应用 |
| **数据库** | PostgreSQL | 主数据库 |
| **缓存** | Redis | 缓存 |
| **存储** | MinIO | 文件存储 |

#### 优势
✅ **架构简单**：易于理解和维护
✅ **开发快速**：无需处理分布式问题
✅ **测试容易**：单元测试和集成测试简单
✅ **部署方便**：单一WAR/JAR包部署

#### 劣势
⚠️ **扩展受限**：无法按模块独立扩展
⚠️ **耦合度高**：模块间容易产生依赖
⚠️ **技术绑定**：无法使用不同技术栈
⚠️ **协作困难**：多团队开发容易冲突

---

### 方案三：混合架构（渐进式）

#### 架构图
```
┌─────────────────────────────────────────────────────────────┐
│                   前端层 (微前端)                            │
│  主应用  │  核心业务子应用  │  独立设计子应用  │  扩展子应用  │
└─────────────────────────────────────────────────────────────┘
                              ▲
┌─────────────────────────────────────────────────────────────┐
│                   后端层 (模块化单体)                        │
│           Spring Boot (多模块，可拆分为微服务)              │
└─────────────────────────────────────────────────────────────┘
                              ▲
┌─────────────────────────────────────────────────────────────┐
│                      数据层                                  │
│  PostgreSQL  │  Redis  │  Kafka  │  Elasticsearch           │
└─────────────────────────────────────────────────────────────┘
```

#### 技术栈清单

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **前端** | React + qiankun | 微前端架构 |
| **后端** | Spring Boot模块化 | 预留微服务拆分能力 |
| **数据库** | PostgreSQL | 主数据库 |

#### 优势
✅ **前端独立**：不同模块可独立开发和部署
✅ **后端简单**：初期单体，后期可拆分
✅ **渐进演进**：根据实际需求逐步演进
✅ **平衡复杂度**：前端灵活，后端简单

#### 劣势
⚠️ **架构不统一**：前后端架构不一致
⚠️ **扩展受限**：后端仍无法独立扩展
⚠️ **演进成本**：后期拆分需要重构

---

## 二、方案推荐

### 推荐：方案一（微前端 + 微服务架构）⭐

#### 推荐理由

1. **符合招标要求**
   - 招标文件明确要求"微服务+微前端架构"
   - 评分标准中"架构设计的合理性、先进性"占30分

2. **匹配项目规模**
   - 21个功能模块，代码量巨大
   - 需要多团队并行开发
   - 各模块业务差异大

3. **满足非功能需求**
   - 高并发：≥2000用户，≥10000 RPS
   - 高可用：两地三中心，SLA ≥99.95%
   - 易扩展：按需扩展各服务

4. **现有基础**
   - 已有React前端基础
   - 可快速迁移到qiankun
   - 技术栈符合行业主流

---

## 三、核心技术设计

### 3.1 微前端架构设计

#### qiankun架构
```typescript
// 主应用 (src/main.tsx)
import { registerMicroApps, start } from 'qiankun'

registerMicroApps([
  {
    name: 'business-platform',
    entry: '//localhost:3001',
    container: '#subapp-container',
    activeRule: '/business',
  },
  {
    name: 'design-platform',
    entry: '//localhost:3002',
    container: '#subapp-container',
    activeRule: '/design',
  },
])

start()

// 子导出 (src/public-path.ts)
if (window.__POWERED_BY_QIANKUN__) {
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__
}

export async function bootstrap() {}
export async function mount(props) {}
export async function unmount() {}
```

#### 应用划分

| 应用名称 | 端口 | 包含模块 | 说明 |
|----------|------|----------|------|
| **main-app** | 3000 | 登录、布局、公共组件 | 主应用 |
| **business-app** | 3001 | 市场洞察、原料、叶组、香精等11个模块 | 业务管理平台 |
| **design-app** | 3002 | 设计工作台、叶组配方设计等10个模块 | 设计平台 |

### 3.2 微服务架构设计

#### 服务划分

| 服务名称 | 职责 | 技术栈 |
|----------|------|--------|
| **user-service** | 用户、角色、权限 | Spring Boot |
| **business-service** | 业务管理平台11个模块 | Spring Boot |
| **design-service** | 设计平台10个模块 | Spring Boot |
| **data-service** | 数据查询、报表 | Spring Boot |
| **ai-service** | AI能力集成 | Python FastAPI |
| **workflow-service** | 工作流引擎 | Flowable |
| **file-service** | 文件管理 | Spring Boot |

#### 服务间通信

```yaml
# 同步通信：OpenFeign
@FeignClient(name = "data-service")
public interface DataServiceClient {
    @GetMapping("/api/formula/{id}")
    FormulaDTO getFormula(@PathVariable Long id);
}

# 异步通信：Kafka
@KafkaListener(topics = "formula.created")
public void handleFormulaCreated(FormulaCreatedEvent event) {
    // 处理配方创建事件
}
```

### 3.3 数据架构设计

#### 数据分层

```
┌─────────────────────────────────────────┐
│         应用数据层       │
│  业务库  │  设计库  │  用户库          │
└─────────────────────────────────────────┘
                  ▲
┌─────────────────────────────────────────┐
│       数据仓库层 (OLAP)    │
│  主题：配方、工艺、质量、成本           │
└─────────────────────────────────────────┘
                  ▲
┌─────────────────────────────────────────┐
│       数据湖层 (原始数据)                │
│  结构化  │  半结构化  │  非结构化       │
└─────────────────────────────────────────┘
```

#### 数据库选型

| 数据库 | 用途 | 数据类型 |
|--------|------|----------|
| **PostgreSQL** | 主业务数据 | 结构化数据 |
| **MongoDB** | 实验记录、文档 | 半结构化数据 |
| **Neo4j** | 知识图谱、配方关联 | 图数据 |
| **MinIO** | 文件、图片 | 非结构化数据 |
| **Elasticsearch** | 全文检索 | 文档索引 |

### 3.4 安全架构设计

#### 安全分层

```
┌─────────────────────────────────────────┐
│    网络安全      │
│  WAF  │  DDoS防护  │  VPN               │
└─────────────────────────────────────────┘
                  ▲
┌─────────────────────────────────────────┐
│    应用安全      │
│  OAuth2认证  │  RBAC权限  │  API鉴权     │
└─────────────────────────────────────────┘
                  ▲
┌─────────────────────────────────────────┐
│    数据安全      │
│  SM2/SM4加密  │  AES-256  │  脱敏        │
└─────────────────────────────────────────┘
```

#### 加密方案

| 数据类型 | 加密方式 | 密钥管理 |
|----------|----------|----------|
| **传输数据** | HTTPS (TLS 1.3) | 证书自动轮换 |
| **配方数据** | AES-256 + QDC | 密钥分发服务 |
| **用户密码** | bcrypt (cost=12) | - |
| **敏感字段** | SM4国密 | 国密密钥管理 |

---

## 四、部署架构设计

### 4.1 两地三中心部署

```
┌─────────────────────────────────────────────────────────────┐
│                      北京主中心（生产）                       │
│  K8s集群 × 3节点  │  PostgreSQL主库  │  Redis主库           │
└─────────────────────────────────────────────────────────────┘
                              │
                              └─── 实时同步 ──> ┌─────────────────────────────────────────┐
                                                   │           上海同容中心               │
                                                   │  K8s集群 × 2节点  │  从库  │  从库  │
                                                   └─────────────────────────────────────────┘
                                                              │
                                                              └─── 定时备份 ──> ┌─────────────────────────────────────────┐
                                                                                   │          广州异地灾备中心              │
                                                                                   │  K8s集群 × 1节点  │  备份库        │
                                                                                   └─────────────────────────────────────────┘
```

### 4.2 K8s部署方案

```yaml
# 微服务部署示例 (business-service.yaml)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: business-service
spec:
  replicas: 3  # 3个副本
  selector:
    matchLabels:
      app: business-service
  template:
    metadata:
      labels:
        app: business-service
    spec:
      containers:
      - name: business-service
        image: business-service:1.0.0
        ports:
        - containerPort: 8080
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
        - name: JAVA_OPTS
          value: "-Xms2g -Xmx2g"
        resources:
          requests:
            memory: "2Gi"
            cpu: "1000m"
          limits:
            memory: "4Gi"
            cpu: "2000m"
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health/readiness
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: business-service
spec:
  selector:
    app: business-service
  ports:
  - port: 80
    targetPort: 8080
  type: ClusterIP
```

---

## 五、技术架构总结

### 5.1 核心优势

| 优势 | 说明 |
|------|------|
| **高内聚低耦合** | 21个模块独立开发、部署、扩展 |
| **技术先进** | 微前端+微服务符合行业趋势 |
| **可扩展性强** | 水平扩展，支撑2万+用户 |
| **高可用性** | 两地三中心，SLA ≥99.95% |
| **安全合规** | 国密+等保三级+ISO 27001 |

### 5.2 与招标要求的对应

| 招标要求 | 技术方案 | 满足度 |
|----------|----------|--------|
| 微服务+微前端架构 | qiankun + Spring Cloud | ✅ 完全满足 |
| 高并发（2000用户，10000 RPS） | K8s水平扩展 + Redis缓存 | ✅ 完全满足 |
| 高可用（99.95% SLA） | 两地三中心 + 多副本部署 | ✅ 完全满足 |
| 国密加密 | SM2/SM4 + QDC密钥分发 | ✅ 完全满足 |
| 等保三级 | RBAC+ABAC + 审计日志 | ✅ 完全满足 |
| ISO 27001 | 安全架构+流程管理 | ✅ 完全满足 |

---

## 六、下一步工作

基于这个技术架构，接下来需要：

1. ✅ 技术架构方案设计
2. ⏳ 为21个模块设计详细的技术方案
3. ⏳ 绘制每个模块的业务流程图
4. ⏳ 绘制每个模块的界面原型图
5. ⏳ 完善demo功能的实现

**是否认可这个技术架构方案？确认后我将继续详细设计。**

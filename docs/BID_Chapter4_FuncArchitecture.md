# 第四章 系统功能架构设计

## 4.1 功能架构设计思路
本系统采用**“服务化、组件化、松耦合”**的设计思路。基于Spring Cloud Alibaba微服务架构体系，将庞大的业务系统拆分为多个独立自治、可独立部署的微服务单元。

## 4.2 功能架构层级详解

![功能架构图](docs/ppt/02_Functional_Architecture.png)

### 4.2.1 用户体验层 (User Experience Layer)
提供多终端、角色化的统一访问入口。
*   **PC端科研工作台**：基于React + Ant Design Pro构建。支持卡片式布局，用户可自定义首页（如：我的待办、我的项目、我的报表）。
*   **移动端App/小程序**：基于Uni-app构建。聚焦于移动场景，如：领导审批、实验室扫码收样、原料基地巡检定位、车间现场查阅工艺标准。
*   **数字化大屏**：基于ECharts/DataV构建。部署在技术中心大厅或会议室，实时展示研发动态、质量趋势。

### 4.2.2 业务应用层 (Business Application Layer)
本层包含了招标与PRD要求的11大核心业务模块，是系统的功能载体。

**(1) 研发设计类应用**
*   **市场洞察服务**：提供舆情分析、问卷调查、画像分析功能。
*   **配方设计服务**：提供叶组/香精的配方维护、版本比对、智能推荐、成本核算功能。
*   **工艺设计服务**：提供工艺标准建模、参数仿真、变更管理功能。
*   **材料设计服务**：提供辅材选型、外观设计协同功能。

**(2) 业务管理类应用**
*   **实验室管理服务 (LIMS)**：提供检测业务流转、资源管理、报告管理功能。
*   **质量管理服务**：提供IQC/OQC检验、质量判定、统计分析功能。
*   **在线试验服务**：提供试验排产、物料追踪、过程记录功能。
*   **原料管理服务**：提供基地档案、库存预警、采购辅助功能。
*   **综合管理服务**：提供项目管理、资产管理、绩效管理功能。

**(3) 智能辅助类应用**
*   **科研助手服务**：提供知识检索、翻译、文档生成功能。

### 4.2.3 业务中台层 (Business Middle Platform)
沉淀共性业务能力，支持上层应用的快速构建与变通。
*   **用户中心 (User Center)**：统一管理组织机构、人员信息、角色权限（RBAC）。支持SSO单点登录。
*   **流程中心 (BPM Center)**：集成Camunda/Flowable工作流引擎，提供可视化的流程设计器、任务分发、流程监控能力。
*   **消息中心 (Message Center)**：统一管理站内信、短信、邮件、App推送。支持消息模板配置。
*   **文档中心 (Doc Center)**：提供非结构化文档（PDF, Word, 图片）的存储、预览、全文检索、版本控制能力。
*   **报表中心 (Report Center)**：提供拖拽式的自助报表设计器，支持清单表、交叉表、图表的配置。

### 4.2.4 数据中台层 (Data Middle Platform)

![数据架构图](docs/ppt/03_Data_Architecture.png)
*   **数据集成 (ETL)**：负责从ERP、MES、OA及外部互联网采集数据。
*   **数据治理**：提供元数据管理、数据标准管理、数据质量稽核功能。
*   **数据资产目录**：可视化的数据地图，展示有哪些数据、数据在哪里、谁在用。
*   **算法服务平台 (AI Lab)**：提供机器学习模型的训练、部署、发布服务（ModelOps）。

### 4.2.5 技术底座层 (Infrastructure Layer)
*   **容器云平台**：Docker + Kubernetes，实现资源的池化管理与弹性伸缩。
*   **DevOps平台**：GitLab + Jenkins，实现持续集成与持续交付。
*   **中间件服务**：Redis（缓存）、RocketMQ（消息队列）、MySQL（关系库）、MongoDB（文档库）、Neo4j（图库）、MinIO（对象存储）。

## 4.3 关键技术特性

### 4.3.1 全文检索与知识图谱
利用Elasticsearch实现亿级数据的毫秒级全文检索。利用Neo4j构建“配方-原料-工艺-质量”知识图谱，通过图算法发现潜在的关联规则（如：某种香料与特定工艺结合容易产生杂气）。

### 4.3.2 离线优先与数据同步
针对移动端在车间或基地可能信号不佳的场景，App支持离线数据采集（如：暂存表单、照片）。待网络恢复后，自动利用断点续传技术同步至服务器，确保数据不丢失。

系统内置低代码表单引擎。对于简单的行政类流程或临时的数据收集任务，业务人员无需写代码，通过拖拽组件即可快速发布一个功能页面，极大地提高了系统的灵活性。

### 4.3.4 分布式事务保障 (Seata)
采用Seata框架的AT模式，解决跨微服务调用（如：配方服务调用库存服务、成本服务）时的一致性问题。当业务出现异常时，确保所有涉及的数据库操作要么全部成功，要么全部回滚，保证数据的高度一致性。

### 4.3.5 多级缓存架构
为了应对高并发查询（如几千个配方的成本实时计算），设计了“Caffeine本地缓存 + Redis分布式缓存”的两级缓存架构。热点数据（如字典表、常用原料）优先从本地内存读取，极大降低了网络开销和数据库压力，系统响应时间控制在200ms以内。

### 4.3.6 国密算法加密
全面遵循信创安全要求，关键敏感数据（用户密码、烟叶配方比例）在入库前使用国密SM4算法进行加密。数据传输使用国密SM2算法替换标准的RSA算法，确保系统完全符合国家商用密码管理规定。

